<%= stylesheet_link_tag "/lib/leaflet/dist/leaflet.css" %>
<%= stylesheet_link_tag "/lib/leaflet-environmental-layers/dist/LeafletEnvironmentalLayers.css" %>
<%= javascript_include_tag('/lib/leaflet-environmental-layers/dist/LeafletEnvironmentalLayers.js') %>
<%= javascript_include_tag('/lib/leaflet-environmental-layers/dist/windRoseLayer.js') %>
<%= javascript_include_tag('/lib/leaflet-fullhash/leaflet-fullHash.js') %>
<%= javascript_include_tag('https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js') %>
<%= stylesheet_link_tag "https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css" %>

<%= javascript_include_tag('/lib/leaflet-spin/example/spin/dist/spin.min.js') %>
<%= javascript_include_tag('/lib/leaflet-spin/example/leaflet.spin.min.js') %>

<div class="container-fluid">
  <div id="mapknitter-unique" style="height: 300px ; width: 100% ;  margin-bottom: 1%; z-index: 5;"></div>
  <br><br> <br>
  <div class="row text-center" id="info">
      <div class="col-md-4 col-sm-5 offset-1">
          <i class="fas fa-globe"  style="color:gray;"></i>
          <h3>Make your own map </h3>
          <p>Use a kite, balloon, pole or drone to take an aerial photo and tell your own visual story of the place </p>
               </div>
      <div class="col-md-4 col-sm-5 offset-1">
          <i class="fa fa-industry"  style="color:gray;"></i>
          <h3>Environmental data<br> near here </h3>
          <p>A range of groups publish environmental data here. Read more or share your own map data </p>
          <hr>
          <div class="text-left">
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:blue;"></i>
              <%= link_to 'Frac Tracker', 'https://www.fractracker.org', target: :_blank %>  &emsp; &emsp; Oil and gas infrastructure
              </p>
              <hr>
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:yellow;"></i>
              <%= link_to 'JusticeMap', 'https://www.justicemap.org/', target: :_blank%> &emsp; &emsp;  Race, ethnicity & demographic data
              </p>
              <hr>
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:purple;"></i>
              <%= link_to 'OdorLog.com', '#' , target: :_blank%> &emsp;  Community reports of odors
              </p>
              <hr>
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:red;"></i>
              <%= link_to 'OpenAQ Air', 'https://openaq.org', target: :_blank%> &emsp; &emsp; Quality data from various sources
              </p>
              <hr>
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:green;"></i>
              <%= link_to 'Toxic Release', 'https://www.epa.gov/toxics-release-inventory-tri-program', target: :blank %> &emsp; &nbsp; Inventory US gov't collected data from polluting industry
              </p>
              <hr>
              <p>
              <span class="fa-stack fa-2x">
                  <i class="far fa-square fa-stack-2x"></i>
                  <i class="fas fa-times fa-stack-1x"></i>
              </span>
              <i class="fa fa-circle" style="font-size:20px;color:#20B2AA;"></i>
              <%= link_to 'SkyTruth Alerts', 'https://alerts.skytruth.org/', target: :blank%> &emsp; &nbsp; Recent state-level reports of pollution
              </p>

          </div>
  <br><br>
  <br><br>
      </div>
  </div>
  <div class="container-fluid" id ="light-blue">
    <div class="section-header text-center">
        <h2 class="section-title">Featured Mappers</h2>
    </div>
    <%= render :partial => 'featured_mappers', :locals => { :mappers => @mappers } %>
  </div>
  <div class="container-fluid">
      <div class="row text-center" id="info">
          <div class="col-md-4 col-sm-5 offset-1">
              <span class="fa-stack" style="vertical-align: bottom; color:gray; font-size:4em;">
                  <i class="far fa-comment-alt fa-stack-2x" ></i>
                  <i class="fas fa-question fa-question fa-stack-1x" style="font-size:0.7em;" ></i>
              </span>
              <br><br>
              <h3>Ask a question</h3>
              <br>
              <p> Get help from others and share ideas with the PublicLab Community</p>
  <br>
              <p> <%= link_to "Ask a question", '#', class: "btn btn-lg btn-primary" %></p>
          </div>
          <div class="col-md-4 col-sm-5 offset-1">
              <i class="fas fa-binoculars"></i>
              <br>
              <h3>Projects/ Requests for observations</h3>
              <br>
              <p> Community observations and moitoring are a key source of environmental data. Help add to one of the [projects] here. Read more or post your oen call for input</p>
              <p> <%= link_to "Post an Observation", '#', class: "btn btn-outline-secondary btn-lg" %></p>

          </div>
      </div>
  </div>

<script>
  $(function(){
    $("#loginModal").appendTo("body");
  });
    var bounds = new L.LatLngBounds(new L.LatLng(84.67351257 , -172.96875) , new L.LatLng(-54.36775852 , 178.59375)) ;
    var Mapknitterunique = new L.map('mapknitter-unique' , {
      maxBounds: bounds , 
      maxBoundsViscosity: 0.75
    }).setView([43, -83] , 2);  
    Mapknitterunique.options.minZoom = 2 ;

    //L.tileLayer('').addTo() ; 
  //  L.layerGroup.mapKnitterLayer().addTo(Mapknitterunique);

  var token = "pk.eyJ1Ijoianl3YXJyZW4iLCJhIjoiVzVZcGg3NCJ9.BJ6ArUPuTs1JT9Ssu3K8ig";
  var baselayer = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/outdoors-v11/tiles/{z}/{x}/{y}?access_token=' + token, {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(Mapknitterunique);


    Mapknitterunique.addControl(new L.Control.Fullscreen()); // to go full-screen
    Mapknitterunique.on('fullscreenchange', function () {
      if (Mapknitterunique.isFullscreen()) {
        Mapknitterunique.options.minZoom = 3 ;
       } 
      else {
        Mapknitterunique.options.minZoom = 1 ;
       // Mapknitterunique.panTo(new L.LatLng(lat,lon));
      }
    });

   // var PurpleLayer = L.layerGroup.purpleLayer() ;
    var PurpleAirMarkerLayer = L.layerGroup.purpleAirMarkerLayer() ;
    var SkyTruth = L.layerGroup.skyTruthLayer() ;
    var Fractracker = L.layerGroup.fracTrackerLayer() ;
    var OdorReport = L.layerGroup.odorReportLayer() ;
    var MapKnitter = L.layerGroup.mapKnitterLayer().addTo(Mapknitterunique) ;
    var ToxicRelease = L.layerGroup.toxicReleaseLayer() ;

    var OpenInfraMap_Power = L.tileLayer('https://tiles-{s}.openinframap.org/power/{z}/{x}/{y}.png',{
        maxZoom: 18,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://www.openinframap.org/about.html">About OpenInfraMap</a>'
    });
    var OpenInfraMap_Petroleum = L.tileLayer('https://tiles-{s}.openinframap.org/petroleum/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://www.openinframap.org/about.html">About OpenInfraMap</a>'
    });
    var OpenInfraMap_Telecom = L.tileLayer('https://tiles-{s}.openinframap.org/telecoms/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://www.openinframap.org/about.html">About OpenInfraMap</a>'
    });
    var OpenInfraMap_Water = L.tileLayer('https://tiles-{s}.openinframap.org/water/{z}/{x}/{y}.png',{
      maxZoom: 18,
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, <a href="http://www.openinframap.org/about.html">About OpenInfraMap</a>'
    });

    var Justicemap_income = L.tileLayer.provider('JusticeMap.income') ;
    var JusticeMap_americanIndian = L.tileLayer.provider('JusticeMap.americanIndian') ;
    var JusticeMap_asian = L.tileLayer.provider('JusticeMap.asian') ;
    var JusticeMap_black = L.tileLayer.provider('JusticeMap.black') ;
    var JusticeMap_multi = L.tileLayer.provider('JusticeMap.multi') ;
    var JusticeMap_hispanic = L.tileLayer.provider('JusticeMap.hispanic') ;
    var JusticeMap_nonWhite = L.tileLayer.provider('JusticeMap.nonWhite') ;
    var JusticeMap_white = L.tileLayer.provider('JusticeMap.white') ;
    var JusticeMap_plurality = L.tileLayer.provider('JusticeMap.plurality') ;
    
    var clouds = L.OWM.clouds({showLegend: true, opacity: 0.5});
    var cloudscls = L.OWM.cloudsClassic({});
    var precipitation = L.OWM.precipitation({});
    var precipitationcls = L.OWM.precipitationClassic({});
    var rain = L.OWM.rain({});
    var raincls = L.OWM.rainClassic({});
    var snow = L.OWM.snow({});
    var pressure = L.OWM.pressure({});
    var pressurecntr = L.OWM.pressureContour({});
    var temp = L.OWM.temperature({});
    var wind = L.OWM.wind({});

    var city = L.OWM.current({intervall: 15, minZoom: 3});
    var windrose = L.OWM.current({intervall: 15, minZoom: 3, markerFunction: myWindroseMarker, popup: false, clusterSize: 50,imageLoadingBgUrl: 'https://openweathermap.org/img/w0/iwind.png' });
    windrose.on('owmlayeradd', windroseAdded, windrose); 

    var baseMaps = {
      "Baselayer1": baselayer
    };
    var overlayMaps = {
     // "PurpleAirLayer-HeatMap": PurpleLayer ,
      "PurpleAirLayer-Markers": PurpleAirMarkerLayer ,
      "SkyTruth": SkyTruth , 
      "Fractracker" : Fractracker ,
      "ToxicRelease": ToxicRelease ,
      "OdorReport": OdorReport ,
      "MapKnitter": MapKnitter ,
      "OpenInfraMap_Power": OpenInfraMap_Power ,
      "OpenInfraMap_Telecom": OpenInfraMap_Telecom ,
      "OpenInfraMap_Petroleum": OpenInfraMap_Petroleum ,
      "OpenInfraMap_Water": OpenInfraMap_Water ,
      "Justicemap_income": Justicemap_income,
      "JusticeMap_americanIndian": JusticeMap_americanIndian ,
      "JusticeMap_asian": JusticeMap_asian ,
      "JusticeMap_black": JusticeMap_black,
      "JusticeMap_multi": JusticeMap_multi ,
      "JusticeMap_hispanic": JusticeMap_hispanic ,
      "JusticeMap_nonWhite": JusticeMap_nonWhite,
      "JusticeMap_white": JusticeMap_white ,
      "JusticeMap_plurality": JusticeMap_plurality ,
         "Clouds": clouds ,
         "clouds (classic)": cloudscls ,
         "precipitation": precipitation ,
         "precipitation (classic)": precipitationcls , 
         "rain": rain , 
         "rain (classic)": raincls ,
         "snow": snow , 
         "pressure": pressure ,
         "pressure contour (zoom in)": pressurecntr , 
         "temp": temp , 
         "wind": wind , 
         "Cities (zoom in)": city  , 
         "windrose (zoom in)": windrose
    };
    L.control.layers(baseMaps,overlayMaps).addTo(Mapknitterunique);
    
</script>
